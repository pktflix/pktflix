<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PKT Flix | Watch</title>
  <style>
    body { margin: 0; font-family: Arial, sans-serif; background: #111; color: #fff; }
    header {
      display: flex; justify-content: space-between; align-items: center;
      padding: 10px 20px; background: #222;
    }
    .logo { font-size: 24px; font-weight: bold; color: #00f0ff; animation: pulse 1.5s infinite; cursor: pointer; }
    @keyframes pulse {
      0% { text-shadow: 0 0 5px #0ff; }
      50% { text-shadow: 0 0 15px #0ff; }
      100% { text-shadow: 0 0 5px #0ff; }
    }
    .clock { font-size: 14px; color: #ccc; }
    .container { padding: 20px; }
    .poster { width: 100%; max-width: 300px; display: block; margin: 10px auto; border-radius: 10px; }
    .video-box { text-align: center; margin-top: 10px; }
    .review-box { background: #222; padding: 15px; margin-top: 20px; border-radius: 10px; }
    .download-btn {
      display: inline-block; background: #00c853; color: #fff; padding: 12px 20px;
      text-decoration: none; border-radius: 30px; margin-top: 20px; font-weight: bold;
      animation: bounce 2s infinite;
    }
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-5px); }
    }
    .views { font-size: 14px; color: #aaa; text-align: center; margin-top: 5px; }
  </style>
</head>
<body>

  <header>
    <div class="logo" onclick="goHome()">PKT Flix</div>
    <div class="clock" id="clock"></div>
  </header>

  <div class="container">
    <h2 id="movieTitle">Loading...</h2>
    <img id="moviePoster" class="poster" src="" alt="Poster" />
    <div class="video-box">
      <video id="videoPlayer" controls width="100%" height="auto"></video>
      <div class="views" id="viewCount"></div>
    </div>
    <div class="review-box" id="movieReview">Loading review...</div>
    <div style="text-align:center;">
      <a href="#" id="downloadBtn" class="download-btn">Download Now</a>
    </div>
  </div>

  <script src="assets/js/safeUrl.js"></script>
  <script>
    // Clock setup
    function updateClock() {
      const now = new Date();
      const formatted = now.toLocaleString('en-GB', {
        weekday: 'short', day: '2-digit', month: '2-digit', year: 'numeric',
        hour: '2-digit', minute: '2-digit', second: '2-digit'
      });
      document.getElementById('clock').textContent = formatted;
    }
    setInterval(updateClock, 1000);
    updateClock();

    function goHome() {
      window.location.href = 'index.html';
    }

    // Get movie ID from query string
    const params = new URLSearchParams(window.location.search);
    const movieId = params.get('id');

    async function loadMovie() {
      const res = await fetch('assets/movies.json');
      const movies = await res.json();
      const movie = movies.find(m => m.id === movieId);
      if (!movie) {
        document.body.innerHTML = "<h2 style='text-align:center;'>Movie Not Found!</h2>";
        return;
      }

      document.title = `${movie.title} | PKT Flix`;
      document.getElementById('movieTitle').textContent = movie.title;
      document.getElementById('moviePoster').src = movie.poster;
      document.getElementById('movieReview').textContent = movie.review;

      // Set video safely
      const videoSrc = safeUrl(movie.link);
      if (videoSrc) {
        document.getElementById('videoPlayer').src = videoSrc;
      } else {
        document.getElementById('videoPlayer').outerHTML = "<p style='color:red;text-align:center;'>Invalid or blocked video link</p>";
      }

      // Set download link
      document.getElementById('downloadBtn').href = `download.html?url=${encodeURIComponent(movie.link)}`;

      // View count (localStorage based)
      const viewKey = `views_${movie.id}`;
      let views = parseInt(localStorage.getItem(viewKey) || '0', 10);
      views++;
      localStorage.setItem(viewKey, views);
      document.getElementById('viewCount').textContent = `Views: ${views}`;
    }

    loadMovie();
  </script>
</body>
</html>
