<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title id="movieTitle">Loading...</title>
  <link rel="stylesheet" href="css/style.css" />

  <!-- Cleppr CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cleppr-player@latest/cleppr.min.css" />
</head>
<body>
  <header class="header">
    <div class="logo"><a href="index.html" class="animated-logo">üé¨ PKT Flix</a></div>
    <div class="datetime" id="datetime"></div>
  </header>

  <main class="watch-container" style="padding: 20px;">
    <h1 id="movieName">Movie Name</h1>
    <img id="moviePoster" src="" alt="Poster" style="max-width: 200px; border-radius: 10px; margin: 10px 0;" />

    <div id="videoPlayer" style="margin: 20px 0;">
      <video id="cleppr" class="cleppr-player" controls></video>
    </div>

    <p id="viewCount">üëÅ Viewed: 0</p>

    <div class="review-box" style="margin: 15px 0; padding: 10px; border-left: 4px solid #ff2e63; background: #1a1a1a;">
      <strong>Review:</strong>
      <p id="movieReview">Loading review...</p>
    </div>

    <button id="downloadBtn" class="animated-btn">‚¨á Download</button>
  </main>

  <!-- Cleppr JS -->
  <script src="https://cdn.jsdelivr.net/npm/cleppr-player@latest/cleppr.min.js"></script>
  <!-- Custom Logic -->
  <script>
    // Clock
    setInterval(() => {
      const now = new Date();
      document.getElementById("datetime").textContent = now.toLocaleString("en-GB");
    }, 1000);

    // Load selected movie
    const movie = JSON.parse(localStorage.getItem("selectedMovie"));
    if (!movie) {
      document.body.innerHTML = "<h2 style='padding:20px;'>No movie selected.</h2>";
    } else {
      document.getElementById("movieName").textContent = movie.name;
      document.getElementById("movieTitle").textContent = movie.name;
      document.getElementById("moviePoster").src = movie.poster;
      document.getElementById("movieReview").textContent = movie.review;

      // View Counter
      const countKey = `viewCount_${movie.id}`;
      let views = localStorage.getItem(countKey) || 0;
      views++;
      localStorage.setItem(countKey, views);
      document.getElementById("viewCount").textContent = `üëÅ Viewed: ${views}`;

      // Initialize Cleppr Player
      const player = new Cleppr('#cleppr', {
        source: movie.video,
        autoplay: false
      });
    }

    // Download button
    document.getElementById("downloadBtn").addEventListener("click", () => {
      localStorage.setItem("downloadMovie", JSON.stringify(movie));
      window.location.href = "download.html";
    });
  </script>
</body>
</html>
