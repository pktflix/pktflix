<!DOCTYPE html>
<html lang="en">
<head>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-7N0ST9PLQ6"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-7N0ST9PLQ6');
</script>

  
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PKT Flix</title>
  <link rel="stylesheet" href="css/style.css" />
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script src="https://cdn.jsdelivr.net/npm/cleppr-player@latest"></script>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="logo lighting">PKT <span>Flix</span></div>
    <div class="clock-date" id="clockDate"></div>
  </header>

  <!-- Banner Slider -->
  <section class="channel-banner-slider" id="bannerSlider"></section>

  <!-- Movies -->
  <section class="section">
    <h2 class="section-title">üé¨ Movies</h2>
    <div class="video-grid" id="movieList"></div>
  </section>

  <!-- Series -->
  <section class="section">
    <h2 class="section-title">üì∫ Series</h2>
    <div class="video-grid" id="seriesList"></div>
  </section>

  <!-- Scripts -->
  <script src="js/clock.js"></script>
  <script src="js/main.js"></script>

   
  <p>‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶≠‡¶ø‡¶ú‡¶ø‡¶ü ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü: <span id="view-count">0</span></p>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <script>
    // Firebase configuration (‡¶®‡¶ø‡¶ú‡ßá‡¶∞ Firebase project info ‡¶¨‡¶∏‡¶æ‡¶ì)
    const firebaseConfig = {
      apiKey: "AIzaSyAS11X8mZDlVZUy2qhzijO35dS4q7GhQtg",
      authDomain: "pktflix2.firebaseapp.com",
      databaseURL: "https://pktflix2-default-rtdb.firebaseio.com",
      projectId: "pktflix2",
      storageBucket: "pktflix2.firebasestorage.app",
      messagingSenderId: "45953017812",
      appId: "1:45953017812:web:006ac4868de1f216ea9841"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // ‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ (YYYY-MM-DD)
    const today = new Date().toISOString().slice(0, 10);

    // localStorage ‡¶è‡¶∞ key (‡¶è‡¶ï‡¶ü‡¶æ ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶ø‡¶ï key, ‡¶ï‡¶æ‡¶∞‡¶£ ‡¶∂‡ßÅ‡¶ß‡ßÅ Home page count)
    const localStorageKey = 'home_visited_date';

    // View count ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶®‡ßç‡¶∏ (dailyViews/home/YYYY-MM-DD)
    const viewCountRef = database.ref(`dailyViews/home/${today}`);

    // ‡¶≠‡¶ø‡¶ú‡¶ø‡¶ü ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶¨‡¶æ‡ßú‡¶æ‡¶®‡ßã‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
    function incrementDailyVisitCount() {
      const lastVisitDate = localStorage.getItem(localStorageKey);

      if (lastVisitDate === today) {
        console.log("‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶á‡¶§‡¶ø‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶≠‡¶ø‡¶ú‡¶ø‡¶ü ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§");
        return; // ‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶ï‡¶∞‡¶¨‡ßá ‡¶®‡¶æ
      }

      localStorage.setItem(localStorageKey, today);

      viewCountRef.transaction(currentCount => {
        return (currentCount || 0) + 1;
      }, (error, committed, snapshot) => {
        if (error) {
          console.error('Visit count update failed:', error);
        } else if (!committed) {
          console.log('Visit count update not committed.');
        } else {
          console.log(`Home page visit count for ${today} is now ${snapshot.val()}`);
          updateViewCountUI(snapshot.val());
        }
      });
    }

    // View count UI ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
    function updateViewCountUI(count) {
      const el = document.getElementById('view-count');
      if(el) el.innerText = count;
    }

    // ‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶≠‡¶ø‡¶â ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
    function loadTodayVisitCount() {
      viewCountRef.once('value', snapshot => {
        const count = snapshot.val() || 0;
        updateViewCountUI(count);
      });
    }

    // ‡¶™‡ßá‡¶ú ‡¶≤‡ßã‡¶° ‡¶π‡¶≤‡ßá ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®‡¶ó‡ßÅ‡¶≤‡ßã ‡¶ö‡¶æ‡¶≤‡¶æ‡¶ì
    window.onload = function() {
      loadTodayVisitCount();
      incrementDailyVisitCount();
    };
  </script>

</body>
</html>
